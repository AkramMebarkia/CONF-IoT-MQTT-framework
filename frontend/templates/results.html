<!DOCTYPE html>
<html>
<head>
  <title>Simulation Results - {{ broker_name }}</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-4">
  <h2>ðŸ“Š Results for <code>{{ broker_name }}</code></h2>

  <h4>ðŸ§ª Evaluation Metrics</h4>
  <ul>
    <li><strong>Messages Received:</strong> {{ stats.delay_count }}</li>
    <li><strong>Average Delay:</strong> {{ stats.avg_delay }} ms</li>
    <li><strong>Min Delay:</strong> {{ stats.min_delay }} ms</li>
    <li><strong>Max Delay:</strong> {{ stats.max_delay }} ms</li>
    <li><strong>Packet Loss:</strong> {{ stats.packet_loss_pct }}%</li>
    <li><strong>Throughput:</strong> {{ stats.throughput_mps }} messages/sec</li>
  </ul>

  <h4>ðŸ“ˆ Resource Usage (CPU/RAM)</h4>
  <canvas id="cpuChart" width="600" height="200"></canvas>
  <canvas id="ramChart" width="600" height="200"></canvas>

  <script>
    const resourceData = {{ resource_data | safe }};
    const labels = resourceData.map(d => new Date(d.timestamp).toLocaleTimeString());

    const cpu = resourceData.map(d => parseFloat(d.cpu_percent));
    const mem = resourceData.map(d => {
      const used = parseFloat(d.mem_usage);
      const limit = parseFloat(d.mem_limit);
      return limit ? (used / limit * 100).toFixed(2) : 0;
    });

    new Chart(document.getElementById("cpuChart"), {
      type: 'line',
      data: {
        labels,
        datasets: [{ label: 'CPU %', data: cpu }]
      }
    });

    new Chart(document.getElementById("ramChart"), {
      type: 'line',
      data: {
        labels,
        datasets: [{ label: 'Memory Usage %', data: mem }]
      }
    });
  </script>
</body>
</html>
